# Пример приложения UWP, подключающегося к Office 365 и использующего Microsoft Graph

**Содержание**  

* [Введение](#introduction)  
* [Предварительные требования](#prerequisites)  
* [Поиск универсального кода ресурса (URI) для перенаправления, назначенного системой](#redirect)  
* [Регистрация и настройка приложения](#register)  
* [Сборка и отладка](#build)  
* [Вопросы и комментарии](#questions)  
* [Дополнительные ресурсы](#additional-resources)  

<a name="introduction"></a>
##Введение

В этом примере показано, как подключить универсальное приложение для Windows 10 к Office 365 с помощью API Microsoft Graph (прежнее название — единый API Office 365), чтобы можно было отправлять электронную почту. Кроме того, в этом примере для проверки подлинности пользователей в клиенте используется новый [API WebAccountManager](http://blogs.technet.com/b/ad/archive/2015/08/03/develop-windows-universal-apps-with-azure-ad-and-the-windows-10-identity-api.aspx) для Windows 10.

> Примечание. Сведения о коде для вызова Microsoft Graph в приложении UWP см. в статье [Вызов Microsoft Graph в универсальном приложении для Windows 10](https://graph.microsoft.io/docs/platform/uwp).


<a name="prerequisites"></a>
## Предварительные требования ##

**Примечание.** Перейдите на страницу [Начало работы с API Office 365](http://dev.office.com/getting-started/office365apis?platform=option-windowsuniversal#setup) для упрощенной регистрации, чтобы ускорить запуск этого примера.

Для этого приложения требуются перечисленные ниже компоненты.

  * Visual Studio 2015. 
  * Windows 10 ([с включенным режимом разработки](https://msdn.microsoft.com/ru-ru/library/windows/apps/xaml/dn706236.aspx)).
  * Учетная запись Office 365 для бизнеса. Вы можете [подписаться на план Office 365 для разработчиков](https://msdn.microsoft.com/en-us/office/office365/howto/setup-development-environment#bk_Office365Account), включающий ресурсы, которые необходимы для создания приложений Office 365.
  * Клиент Microsoft Azure для регистрации приложения. В Azure Active Directory (AD) доступны службы идентификации, которые приложения используют для проверки подлинности и авторизации. Здесь можно получить пробную подписку: [Microsoft Azure](http://aka.ms/jjm0q7).

**Важно!** Убедитесь, что ваша подписка на Azure привязана к клиенту Office 365. Указания см. в статье [Связывание с Azure AD и учетной записи Office 365 для создания приложений и управления ими](https://msdn.microsoft.com/en-us/office/office365/howto/setup-development-environment#bk_CreateAzureSubscription).

<a name="redirect"></a>
## Поиск универсального кода ресурса (URI) для перенаправления, который система назначила приложению

Перед регистрацией приложения на портале Azure необходимо узнать универсальный код ресурса (URI) для перенаправления, заданный приложению. Windows 10 предоставляет каждому приложению уникальное значение универсального кода ресурса (URI), благодаря чему сообщения, отправленные на этот URI, направляются только в это приложение. Чтобы определить универсальный код ресурса (URI) для перенаправления, выполните перечисленные ниже действия.

1. Откройте решение в Visual Studio 2015. 
2. Убедитесь в том, что используется 32- или 64-разрядная целевая платформа.
3. Нажмите клавишу F5.
4. После запуска приложения нажмите кнопку **Копировать**![замещающий текст](../readme-images/copy_icon.png), расположенную в меню в верхнем левом углу приложения. Универсальный код ресурса (URI) для перенаправления будет скопирован в буфер обмена. 
5. Сохраните это значение. Оно будет использоваться при регистрации приложения, как описано в следующем разделе. 


Универсальный код ресурса (URI) для перенаправления будет выглядеть примерно так: 
```
ms-appx-web://Microsoft.AAD.BrokerPlugIn/S-1-15-2-694665007-945573255-503870805-3898041910-4166806349-50292026-2305040851
```


<a name="register"></a>
##Регистрация и настройка приложения

1.	Войдите на [портал управления Azure](http://aka.ms/i5b8dz) с помощью учетных данных Azure AD.
2.	Щелкните **Active Directory** в левом меню, а затем выберите каталог для сайта разработчика Office 365.
3.	В верхнем меню щелкните **Приложения**.
4.	Выберите команду **Добавить** в нижнем меню.
5.	На странице **Что вы хотите сделать?** щелкните **Добавить приложение, разрабатываемое моей организацией**.
6.	На странице **Расскажите о своем приложении** выберите тип **Собственное клиентское приложение** и укажите его имя, например **O365-UWP-Connect**.
7.	Щелкните значок стрелки в правом нижнем углу страницы.
8.	На странице **Сведения о приложении** введите значение универсального кода ресурса (URI) для перенаправления, полученное на предыдущем шаге.
9.	После успешного добавления приложения вы перейдете на страницу **Быстрый запуск** для приложения. Здесь выберите пункт **Настройка** в верхнем меню.
10.	В разделе **Разрешения для других приложений** выберите элемент **Добавить приложение**. В диалоговом окне выберите приложение **Microsoft Graph**. Вернувшись на страницу настройки приложения, выберите разрешения **Отправка почты от имени пользователя** и **Вход и чтение профиля пользователя**.
11.	Скопируйте значение, указанное для **идентификатора клиента** на странице **Настройка**.
12.	В нижнем меню нажмите кнопку **Сохранить**.

<a name="build"></a>
## Сборка и отладка ##

**Примечание.** Если во время установки пакетов при выполнении шага 2 возникают ошибки, убедитесь, что локальный путь к решению не слишком длинный. Чтобы устранить эту проблему, переместите решение ближе к корню диска.

1. После загрузки решения в Visual Studio настройте приложение на использование идентификатора клиента, зарегистрированного в Azure Active Directory, а также домена клиента. Для этого добавьте соответствующие значения для этих ключей в узел Application.Resources в файле App.xaml. 
![Пример приложения UWP, подключающегося к Office 365 и использующего Microsoft Graph](../readme-images/ClientTenant.png "Значение идентификатора клиента в файле App.xaml")

2. Нажмите клавишу F5 для сборки и отладки. Запустите решение и войдите в Office 365 с помощью учетной записи организации.


<a name="questions"></a>
## Вопросы и комментарии

Мы будем рады получить от вас отзывы о проекте приложения UWP, использующего для подключения Microsoft Graph. Отправляйте нам свои вопросы и предложения в раздел этого репозитория, посвященный [проблемам](https://github.com/OfficeDev/O365-UWP-Microsoft-Graph-Connect/issues).

Ваши отзывы важны для нас. Для связи с нами используйте сайт [Stack Overflow](http://stackoverflow.com/questions/tagged/office365+or+microsoftgraph). Помечайте свои вопросы тегами [MicrosoftGraph] и [office365].

<a name="additional-resources"></a>
## Дополнительные ресурсы ##

- [Другие примеры приложений, подключающихся к Office 365](https://github.com/OfficeDev?utf8=%E2%9C%93&query=-Connect)
- [Общие сведения о Microsoft Graph](http://graph.microsoft.io)
- [Общие сведения о платформе API Office 365](https://msdn.microsoft.com/office/office365/howto/platform-development-overview)
- [API Office 365: примеры кода и видео](https://msdn.microsoft.com/office/office365/howto/starter-projects-and-code-samples)
- [Примеры кода решений для Office](http://dev.office.com/code-samples)
- [Центр разработки для Office](http://dev.office.com/)


## Авторские права
(c) Корпорация Майкрософт (Microsoft Corporation), 2015. Все права защищены.


